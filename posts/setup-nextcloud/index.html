<!DOCTYPE html><html lang="" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="msvalidate.01" content="8C807914E603C21473DF8E153B57EBCB" /><meta name="baidu-site-verification" content="code-XMs8EPRzBg" /><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Set Up NextCloud and Coturn on Ubuntu 22 Server" /><meta name="author" content="Piyazon" /><meta property="og:locale" content="" /><meta name="description" content="In this post, I will setup nextcloud from source on ubuntu 22 server, also set up coturn to enable video call from different IPs. Before start, these are the requirements: a Server(SVN) with ubuntu 22 installed create a non-root user on the server a domain name that forwarding to server’s IP, below I use nc.example.com for example, you need to use your own." /><meta property="og:description" content="In this post, I will setup nextcloud from source on ubuntu 22 server, also set up coturn to enable video call from different IPs. Before start, these are the requirements: a Server(SVN) with ubuntu 22 installed create a non-root user on the server a domain name that forwarding to server’s IP, below I use nc.example.com for example, you need to use your own." /><link rel="canonical" href="https://piyazon.top/posts/setup-nextcloud/" /><meta property="og:url" content="https://piyazon.top/posts/setup-nextcloud/" /><meta property="og:site_name" content="Piyazon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-11-16T15:10:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Set Up NextCloud and Coturn on Ubuntu 22 Server" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@Piyazon" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Piyazon"},"description":"In this post, I will setup nextcloud from source on ubuntu 22 server, also set up coturn to enable video call from different IPs. Before start, these are the requirements: a Server(SVN) with ubuntu 22 installed create a non-root user on the server a domain name that forwarding to server’s IP, below I use nc.example.com for example, you need to use your own.","headline":"Set Up NextCloud and Coturn on Ubuntu 22 Server","dateModified":"2024-11-17T13:30:57+08:00","url":"https://piyazon.top/posts/setup-nextcloud/","datePublished":"2024-11-16T15:10:00+08:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://piyazon.top/posts/setup-nextcloud/"},"@context":"https://schema.org"}</script><title>Set Up NextCloud and Coturn on Ubuntu 22 Server | Piyazon</title><link rel="shortcut icon" type="image/png" href="/assets/img/favicons/favicon.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="mask-icon" href="/assets/img/favicons/safari-pinned-tab.svg" color="#5bbad5"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Piyazon"><meta name="application-name" content="Piyazon"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="/assets/jsdelivr/bootstrap.min.css"><link rel="stylesheet" href="/assets/jsdelivr/fontawesome/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="/assets/jsdelivr/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/jsdelivr/magnific-popup.min.css"> <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.updateMermaid(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://gitlab.com/Alimjoo/cdn_img/-/raw/main/penguin.svg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Piyazon</a></div><div class="site-subtitle font-italic">Fearless&Far</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a id="mode-toggle-wrapper" tabindex="0" onclick="flipMode()"> <i class="mode-toggle fas fa-adjust"></i> </a> <span class="icon-border"></span> <a href="https://gitee.com/flame2" aria-label="gitee" target="_blank" rel="noopener" > <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['amichael','mail.ustc.edu.cn'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Set Up NextCloud and Coturn on Ubuntu 22 Server</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Type & hit enter..." dir="auto"> <input style="display: none;" class="form-control" id="search-inputtt" type="search" aria-label="search" autocomplete="off" placeholder="Type & hit enter..." dir="auto"> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel">Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Set Up NextCloud and Coturn on Ubuntu 22 Server</h1><div class="post-meta text-muted"><div> By <em> <a href="https://piyazon.top">Piyazon</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2024-11-16 15:10:00 +0800" data-toggle="tooltip" data-placement="bottom" title="Sat, Nov 16, 2024, 3:10 PM +0800" >Nov 16, 2024</em> </span> <span> Updated <em class="timeago" date="2024-11-17 13:30:57 +0800 " data-toggle="tooltip" data-placement="bottom" title="Sun, Nov 17, 2024, 1:30 PM +0800" >Nov 17, 2024</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1562 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><blockquote><p>In this post, I will setup nextcloud from source on ubuntu 22 server, also set up <em>coturn</em> to enable video call from different IPs. Before start, these are the requirements:</p><ul><li>a Server(SVN) with ubuntu 22 installed<li>create a non-root user on the server<li>a domain name that forwarding to server’s IP, below I use <code class="language-plaintext highlighter-rouge">nc.example.com</code> for example, you need to use your own.</ul></blockquote><h1 id="configure-the-host-name">Configure the host name</h1><ol><li>edit <code class="language-plaintext highlighter-rouge">/etc/hostname</code>, and change the value to <code class="language-plaintext highlighter-rouge">nc.example.com</code><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>vim /etc/hostname
</pre></table></code></div></div><li>edit <code class="language-plaintext highlighter-rouge">/etc/hosts</code><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>vim /etc/hosts
</pre></table></code></div></div><p>and add this line <code class="language-plaintext highlighter-rouge">127.0.1.1 nc.example.com</code> below the localhost. make it looks like this:</p><div class="language-config highlighter-rouge"><div class="code-header"> <span label-text="Config"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span> <span class="n">localhost</span>
<span class="m">127</span>.<span class="m">0</span>.<span class="m">1</span>.<span class="m">1</span> <span class="n">nc</span>.<span class="n">example</span>.<span class="n">com</span>
<span class="c"># The following lines are desirable for IPv6 capable hosts
</span></pre></table></code></div></div><blockquote><p>if <code class="language-plaintext highlighter-rouge">127.0.1.1</code> already exists, change it to <code class="language-plaintext highlighter-rouge">nc.example.com</code></p></blockquote></ol><h1 id="update-the-server-and-reboot">Update the Server and reboot</h1><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt upgrade
<span class="nb">sudo </span>reboot
</pre></table></code></div></div><p>after rebooting try to ping your domain name:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ping nc.example.com
</pre></table></code></div></div><p>if ping through, follow the next step.</p><h1 id="setting-up-mariadb-database">Setting Up MariaDB Database</h1><p>first install MariaDB</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install </span>mariadb-server
<span class="nb">sudo </span>systemctl <span class="nb">enable </span>mariadb
<span class="nb">sudo </span>systemctl start mariadb
<span class="nb">sudo </span>systemctl status mariadb
</pre></table></code></div></div><p>and secure install mysql</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>mysql_secure_installation
</pre></table></code></div></div><p>if this is your first time installing mysql, you dont have a passwd, so when a passwd promt came up just hit <code class="language-plaintext highlighter-rouge">Enter</code>, and set the passwd in follow steps. you can say <code class="language-plaintext highlighter-rouge">Yes</code> to all answers. next open MariaDB Database,</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>mariadb
</pre></table></code></div></div><p>and create nextcloud database and a user by executing below sql commands:</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">nextcloud</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">PRIVILEGES</span> <span class="k">ON</span> <span class="n">nextcloud</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">'nextcloud'</span><span class="o">@</span><span class="s1">'localhost'</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'YOUR_PASSWD_THAT_YOU_SET_IN_PREVIEWS_STEP'</span><span class="p">;</span>
<span class="n">FLUSH</span> <span class="k">PRIVILEGES</span><span class="p">;</span>
</pre></table></code></div></div><p>after finish executing these commands, exit MaraiDB by typing <code class="language-plaintext highlighter-rouge">ctrl+d</code>.</p><h1 id="installing-apache-and-php">Installing Apache and PHP</h1><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install </span>php php-apcu php-bcmath php-cli php-common php-curl php-gd php-gmp php-imagick php-intl php-mbstring php-mysql php-zip php-xml
</pre></table></code></div></div><p>after installing enable and start apache2:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl <span class="nb">enable </span>apache2
<span class="nb">sudo </span>systemctl start apache2
<span class="nb">sudo </span>systemctl status apache2
</pre></table></code></div></div><p>after that, verify the apache2 is correctly running by visit you domain <code class="language-plaintext highlighter-rouge">nc.example.com</code> from your browser, you will see <strong>Apache2 Default Page</strong>, then you can follow the next step, if not make sure previews step are done correctly.</p><h1 id="download-and-install-nextcloud-files">Download and Install NextCloud files</h1><p>download the nextcloud zip file by running:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wget https://download.nextcloud.com/server/releases/latest.zip
</pre></table></code></div></div><p>and then, install <code class="language-plaintext highlighter-rouge">unzip</code> and unzip the latest.zip file by runnig:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install </span>unzip
unzip latest.zip
</pre></table></code></div></div><p>after unzipping, you will see a nextcloud folder in current directory, and then we cp this folder to <code class="language-plaintext highlighter-rouge">/var/www/</code> as name of you domain <code class="language-plaintext highlighter-rouge">nc.example.com</code> by running:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo cp</span> <span class="nt">-r</span> nextcloud /var/www/nc.example.com
</pre></table></code></div></div><p>and change the ownership to <code class="language-plaintext highlighter-rouge">www-data</code> by runnig:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo chown </span>www-data:www-data <span class="nt">-R</span> /var/www/nc.example.com
</pre></table></code></div></div><blockquote><p>Remenber change all <code class="language-plaintext highlighter-rouge">nc.example.com</code> to your own domain name!!!!</p></blockquote><h1 id="setting-up-apache">Setting up Apache</h1><p>first disable the default apache page by runnig:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>a2dissite 000-default
</pre></table></code></div></div><p>create and edit our nextcloud server’s apache config file by runnig:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>vim /etc/apache2/sites-available/nc.example.com.conf
</pre></table></code></div></div><p>and pase these lines inside it and change the <code class="language-plaintext highlighter-rouge">nc.example.com</code> to you own domain.</p><div class="language-config highlighter-rouge"><div class="code-header"> <span label-text="Config"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>&lt;<span class="n">VirtualHost</span> *:<span class="m">80</span>&gt;
    <span class="n">DocumentRoot</span> <span class="s2">"/var/www/nc.example.com"</span>
    <span class="n">ServerName</span> <span class="n">nc</span>.<span class="n">example</span>.<span class="n">com</span>

    &lt;<span class="n">Directory</span> <span class="s2">"/var/www/nc.example.com/"</span>&gt;
        <span class="n">Options</span> <span class="n">MultiViews</span> <span class="n">FollowSymlinks</span>
        <span class="n">AllowOverride</span> <span class="n">All</span>
        <span class="n">Order</span> <span class="n">allow</span>,<span class="n">deny</span>
        <span class="n">Allow</span> <span class="n">from</span> <span class="n">all</span>
    &lt;/<span class="n">Directory</span>&gt;

    <span class="n">TransferLog</span> /<span class="n">var</span>/<span class="n">log</span>/<span class="n">apache2</span>/<span class="n">nc</span>.<span class="n">example</span>.<span class="n">com_access</span>.<span class="n">log</span>
    <span class="n">ErrorLog</span> /<span class="n">var</span>/<span class="n">log</span>/<span class="n">apache2</span>/<span class="n">nc</span>.<span class="n">example</span>.<span class="n">com_error</span>.<span class="n">log</span>
&lt;/<span class="n">VirtualHost</span>&gt;
</pre></table></code></div></div><p>and then enable it on apache by runnig:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>a2ensite nc.example.com.conf 
</pre></table></code></div></div><h1 id="setting-up-php">Setting up PHP</h1><p>you may have different version of PHP than mine, so change the php version to your own in following steps. edit the php init file by runnig:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>vim /etc/php/8.1/apache2/php.ini
</pre></table></code></div></div><p>in this file, search and change the arguments to correct value as below, if it is commented, uncomment it.</p><blockquote><ul><li>Do not directly add, you must search and edit it !!!!!!<li>For <code class="language-plaintext highlighter-rouge">date.timezone</code>, look it up and change to your own region’s time zone</ul></blockquote><div class="language-config highlighter-rouge"><div class="code-header"> <span label-text="Config"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="n">memory_limit</span> = <span class="m">512</span><span class="n">M</span>
<span class="n">upload_max_filesize</span> = <span class="m">200</span><span class="n">M</span>
<span class="n">max_execution_time</span> = <span class="m">360</span>
<span class="n">post_max_size</span> = <span class="m">200</span><span class="n">M</span>
<span class="n">date</span>.<span class="n">timezone</span> = <span class="n">Asia</span>/<span class="n">Hong_Kong</span>
<span class="n">opcache</span>.<span class="n">enable</span>=<span class="m">1</span>
<span class="n">opcache</span>.<span class="n">memory_consumption</span>=<span class="m">128</span>
<span class="n">opcache</span>.<span class="n">interned_strings_buffer</span>=<span class="m">16</span>
<span class="n">opcache</span>.<span class="n">max_accelerated_files</span>=<span class="m">10000</span>
<span class="n">opcache</span>.<span class="n">revalidate_freq</span>=<span class="m">1</span>
<span class="n">opcache</span>.<span class="n">save_comments</span>=<span class="m">1</span>
</pre></table></code></div></div><p>after making changes, save and exit. And run the following command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>a2enmod <span class="nb">dir env </span>headers mime rewrite ssl
<span class="nb">sudo </span>systemctl restart apache2
</pre></table></code></div></div><p>check apache2 status for verify the changes it correct:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl status apache2
</pre></table></code></div></div><p>if apache2 running, then go to your browser and visit you domain name, for example <code class="language-plaintext highlighter-rouge">nc.example.com</code>, if everything is correct you will see nextcloud login page, and then you good to go next step.</p><h1 id="setting-up-a-lets-encript-certificate-via-certbot">Setting up a Let’s Encript certificate via certbot</h1><p>Install snapd</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install </span>snapd
<span class="nb">sudo </span>snap <span class="nb">install </span>core
<span class="nb">sudo </span>snap refresh core
</pre></table></code></div></div><p>install certbot via snap</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>snap <span class="nb">install</span> <span class="nt">--classic</span> certbot
</pre></table></code></div></div><p>maek a soft link</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo ln</span> <span class="nt">-s</span> /snap/bin/certbot /usr/bin/certbot
</pre></table></code></div></div><p>finally make the certificate</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>certbot <span class="nt">--apache</span>
</pre></table></code></div></div><p>inter you email and follow the answers and select the domain and finish.</p><p>Now revisit you domain name in your browser, your domain name will automatically secured as <code class="language-plaintext highlighter-rouge">https://</code>.</p><h1 id="navigating-the-nextcloud-setup-wizard">Navigating the Nextcloud Setup Wizard</h1><ol><li><p>Inter those values and hit Install. <img data-proofer-ignore data-src="https://gitlab.com/Alimjoo/cdn_img/-/raw/main/nextcloud/nextcloud_navigate.png" alt="nextcloud navigate" /></p><li><p>Choose Recommended apps as you like and hit Install <img data-proofer-ignore data-src="https://gitlab.com/Alimjoo/cdn_img/-/raw/main/nextcloud/recommended_apps.png" alt="Recommended apps" /></p></ol><h1 id="resoving-nextcloud-warnings--errors">Resoving Nextcloud Warnings &amp; Errors</h1><p>Nevigate to the <code class="language-plaintext highlighter-rouge">User Icon</code> -&gt; <code class="language-plaintext highlighter-rouge">Administration settings</code>: <img data-proofer-ignore data-src="https://gitlab.com/Alimjoo/cdn_img/-/raw/main/nextcloud/admin_settings.png" alt="Administration settings" /></p><p>You will some error &amp; warnings, No we trying to fix them as much as possible <img data-proofer-ignore data-src="https://gitlab.com/Alimjoo/cdn_img/-/raw/main/nextcloud/security_setup_warnings.png" alt="Security &amp; setup warnings" /></p><h3 id="fix-some-headers-are-not-set-correctly-on-your-instance---the-strict-transport-security-http-header-is-not-set-should-be-at-least-15552000-seconds-for-enhanced-security-it-is-recommended-to-enable-hsts">Fix: Some headers are not set correctly on your instance - The <em>Strict-Transport-Security</em> HTTP header is not set (should be at least <em>15552000</em> seconds). For enhanced security, it is recommended to enable HSTS.`</h3><p>edit `/etc/apache2/sites-available/nc.example.com-le-ssl.conf</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>vim /etc/apache2/sites-available/nc.example.com-le-ssl.conf
</pre></table></code></div></div><p>add these lines below <code class="language-plaintext highlighter-rouge">ServerName</code>:</p><div class="language-config highlighter-rouge"><div class="code-header"> <span label-text="Config"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>&lt;<span class="n">IfModule</span> <span class="n">mod_headers</span>.<span class="n">c</span>&gt;
  <span class="n">Header</span> <span class="n">always</span> <span class="n">set</span> <span class="n">Strict</span>-<span class="n">Transport</span>-<span class="n">Security</span> <span class="s2">"max-age=15552000; includeSubDomains"</span>
&lt;/<span class="n">IfModule</span>&gt;
</pre></table></code></div></div><p>it will looks like this:</p><div class="language-config highlighter-rouge"><div class="code-header"> <span label-text="Config"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>&lt;<span class="n">IfModule</span> <span class="n">mod_ssl</span>.<span class="n">c</span>&gt;
&lt;<span class="n">VirtualHost</span> *:<span class="m">443</span>&gt;
    <span class="n">DocumentRoot</span> <span class="s2">"/var/www/nc.example.com"</span>
    <span class="n">ServerName</span> <span class="n">nc</span>.<span class="n">example</span>.<span class="n">com</span>

    &lt;<span class="n">IfModule</span> <span class="n">mod_headers</span>.<span class="n">c</span>&gt;
      <span class="n">Header</span> <span class="n">always</span> <span class="n">set</span> <span class="n">Strict</span>-<span class="n">Transport</span>-<span class="n">Security</span> <span class="s2">"max-age=15552000; includeSubDomains"</span>
    &lt;/<span class="n">IfModule</span>&gt;

    &lt;<span class="n">Directory</span> <span class="s2">"/var/www/nc.example.com/"</span>&gt;
        <span class="n">Options</span> <span class="n">MultiViews</span> <span class="n">FollowSymlinks</span>
        <span class="n">AllowOverride</span> <span class="n">All</span>
        <span class="n">Order</span> <span class="n">allow</span>,<span class="n">deny</span>
        <span class="n">Allow</span> <span class="n">from</span> <span class="n">all</span>
    &lt;/<span class="n">Directory</span>&gt;

    <span class="n">TransferLog</span> /<span class="n">var</span>/<span class="n">log</span>/<span class="n">apache2</span>/<span class="n">nc</span>.<span class="n">example</span>.<span class="n">com_access</span>.<span class="n">log</span>
    <span class="n">ErrorLog</span> /<span class="n">var</span>/<span class="n">log</span>/<span class="n">apache2</span>/<span class="n">nc</span>.<span class="n">example</span>.<span class="n">com_error</span>.<span class="n">log</span>

<span class="n">SSLCertificateFile</span> /<span class="n">etc</span>/<span class="n">letsencrypt</span>/<span class="n">live</span>/<span class="n">nc</span>.<span class="n">example</span>.<span class="n">com</span>/<span class="n">fullchain</span>.<span class="n">pem</span>
<span class="n">SSLCertificateKeyFile</span> /<span class="n">etc</span>/<span class="n">letsencrypt</span>/<span class="n">live</span>/<span class="n">nc</span>.<span class="n">example</span>.<span class="n">com</span>/<span class="n">privkey</span>.<span class="n">pem</span>
<span class="n">Include</span> /<span class="n">etc</span>/<span class="n">letsencrypt</span>/<span class="n">options</span>-<span class="n">ssl</span>-<span class="n">apache</span>.<span class="n">conf</span>
&lt;/<span class="n">VirtualHost</span>&gt;
&lt;/<span class="n">IfModule</span>&gt;
</pre></table></code></div></div><p>save &amp; exit and restart apache2:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl restart apache2
<span class="nb">sudo </span>systemctl status apache2
</pre></table></code></div></div><h3 id="fix-detected-some-missing-optional-indices-occasionally-new-indices-are-added-by-nextcloud-or-installed-applications-to-improve-database-performance-adding-indices-can-sometimes-take-awhile-and-temporarily-hurt-performance-so-this-is-not-done-automatically-during-upgrades-once-the-indices-are-added-queries-to-those-tables-should-be-faster-use-the-command-occ-dbadd-missing-indices-to-add-them-missing-indices-mail_messages_strucanalyz_idx-in-table-mail_messages-mail_class_creat_idx-in-table-mail_classifiers-mail_acc_prov_idx-in-table-mail_accounts-mail_alias_accid_idx-in-table-mail_aliases-systag_by_objectid-in-table-systemtag_object_mapping-mail_messages_mb_id_uid_uidx-in-table-mail_messages-mail_smime_certs_uid_email_idx-in-table-mail_smime_certificates-mail_trusted_senders_idx-in-table-mail_trusted_senders-mail_coll_idx-in-table-mail_coll_addresses">Fix: Detected some missing optional indices. Occasionally new indices are added (by Nextcloud or installed applications) to improve database performance. Adding indices can sometimes take awhile and temporarily hurt performance so this is not done automatically during upgrades. Once the indices are added, queries to those tables should be faster. Use the command <em>occ db:add-missing-indices</em> to add them. Missing indices: “mail_messages_strucanalyz_idx” in table “mail_messages”, “mail_class_creat_idx” in table “mail_classifiers”, “mail_acc_prov_idx” in table “mail_accounts”, “mail_alias_accid_idx” in table “mail_aliases”, “systag_by_objectid” in table “systemtag_object_mapping”, “mail_messages_mb_id_uid_uidx” in table “mail_messages”, “mail_smime_certs_uid_email_idx” in table “mail_smime_certificates”, “mail_trusted_senders_idx” in table “mail_trusted_senders”, “mail_coll_idx” in table “mail_coll_addresses”.</h3><p>edit <code class="language-plaintext highlighter-rouge">/etc/php/8.1/mods-available/apcu.ini</code> to enable apc cli:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>vim /etc/php/8.1/mods-available/apcu.ini
</pre></table></code></div></div><p>add this line to the end of file:</p><div class="language-config highlighter-rouge"><div class="code-header"> <span label-text="Config"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">apc</span>.<span class="n">enable_cli</span>=<span class="m">1</span>
</pre></table></code></div></div><p>it will somewhat looks like this:</p><div class="language-config highlighter-rouge"><div class="code-header"> <span label-text="Config"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">extension</span>=<span class="n">apcu</span>.<span class="n">so</span>
<span class="n">apc</span>.<span class="n">enable_cli</span>=<span class="m">1</span>
</pre></table></code></div></div><p>make <code class="language-plaintext highlighter-rouge">occ</code> executable, and fix the issue by rinnig:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nb">sudo chmod</span> +x /var/www/nc.example.com/occ
<span class="nb">sudo</span> <span class="nt">-u</span> www-data /var/www/nc.example.com/occ db:add-missing-indices
<span class="nb">sudo </span>systemctl restart apache2
<span class="nb">sudo </span>systemctl status apache2
</pre></table></code></div></div><h3 id="fixone-or-more-mimetype-migrations-are-available-occasionally-new-mimetypes-are-added-to-better-handle-certain-file-types-migrating-the-mimetypes-take-a-long-time-on-larger-instances-so-this-is-not-done-automatically-during-upgrades-use-the-command-occ-maintenancerepair---include-expensive-to-perform-the-migrations">Fix:One or more mimetype migrations are available. Occasionally new mimetypes are added to better handle certain file types. Migrating the mimetypes take a long time on larger instances so this is not done automatically during upgrades. Use the command <code class="language-plaintext highlighter-rouge">occ maintenance:repair --include-expensive</code> to perform the migrations.</h3><p>run the following command to fix it:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo</span> <span class="nt">-u</span> www-data /var/www/nc.example.com/occ maintenance:repair <span class="nt">--include-expensive</span>
</pre></table></code></div></div><h3 id="fix-you-are-currently-running-php-812-1ubuntu219-php-81-is-now-deprecated-in-nextcloud-30-nextcloud-31-may-require-at-least-php-82-please-upgrade-to-one-of-the-officially-supported-php-versions-provided-by-the-php-group-as-soon-as-possible">Fix: You are currently running PHP 8.1.2-1ubuntu2.19. PHP 8.1 is now deprecated in Nextcloud 30. Nextcloud 31 may require at least PHP 8.2. Please upgrade to one of the officially supported PHP versions provided by the PHP Group as soon as possible.</h3><p>I will not gonna fix this, if you want to fix, upgrade the php version to 8.2 or higher and reconfigure the previews steps.</p><h3 id="fix-server-has-no-maintenance-window-start-time-configured-this-means-resource-intensive-daily-background-jobs-will-also-be-executed-during-your-main-usage-time-we-recommend-to-set-it-to-a-time-of-low-usage-so-users-are-less-impacted-by-the-load-caused-from-these-heavy-tasks">Fix: Server has no maintenance window start time configured. This means resource intensive daily background jobs will also be executed during your main usage time. We recommend to set it to a time of low usage, so users are less impacted by the load caused from these heavy tasks.</h3><p>No solution for now.</p><h1 id="install-coturn-and-enable-video-calling-from-different-ips">Install <code class="language-plaintext highlighter-rouge">coturn</code> and enable video calling from different IPs</h1><ol><li>install <code class="language-plaintext highlighter-rouge">coturn</code>:<div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install </span>coturn
<span class="nb">sudo </span>systemctl <span class="nb">enable </span>coturn
<span class="nb">sudo </span>systemctl start coturn
<span class="nb">sudo </span>systemctl status coturn
</pre></table></code></div></div><li>enable coturn by editing <code class="language-plaintext highlighter-rouge">/etc/default/coturn</code><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>vim /etc/default/coturn
</pre></table></code></div></div><p>uncomment or add <code class="language-plaintext highlighter-rouge">TURNSERVER_ENABLED=1</code></p><li>Create Auth-Secret for static-auth-secret by runnig:<div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>openssl rand <span class="nt">-hex</span> 32
</pre></table></code></div></div><li>Back up <code class="language-plaintext highlighter-rouge">/etc/turnserver.conf</code> and edit new one as follow:<div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo mv</span> /etc/turnserver.conf /etc/turnserver.conf.original
<span class="nb">sudo </span>vim /etc/turnserver.conf
</pre></table></code></div></div><p>add following lines to it, replace <code class="language-plaintext highlighter-rouge">YOUR_AUTH_SECRET</code> with your static-auth-secret that created in previews step, replace <code class="language-plaintext highlighter-rouge">nc.example.com</code> with your own domain:</p><div class="language-config highlighter-rouge"><div class="code-header"> <span label-text="Config"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="n">listening</span>-<span class="n">port</span>=<span class="m">3478</span>
<span class="n">fingerprint</span>
<span class="n">use</span>-<span class="n">auth</span>-<span class="n">secret</span>
<span class="n">static</span>-<span class="n">auth</span>-<span class="n">secret</span>=<span class="n">YOUR_AUTH_SECRET</span>
<span class="n">realm</span>=<span class="n">nc</span>.<span class="n">example</span>.<span class="n">com</span>
<span class="n">total</span>-<span class="n">quota</span>=<span class="m">100</span>
<span class="n">bps</span>-<span class="n">capacity</span>=<span class="m">0</span>
<span class="n">stale</span>-<span class="n">nonce</span>=<span class="m">600</span>
<span class="n">no</span>-<span class="n">multicast</span>-<span class="n">peers</span>
</pre></table></code></div></div><li>now we restart <code class="language-plaintext highlighter-rouge">coturn</code> and check it’s status to make sure everything is working:<div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl restart coturn 
<span class="nb">sudo </span>systemctl status coturn 
</pre></table></code></div></div><li>enable <code class="language-plaintext highlighter-rouge">ufw</code> firewall and open <code class="language-plaintext highlighter-rouge">http</code>, <code class="language-plaintext highlighter-rouge">https</code>, <code class="language-plaintext highlighter-rouge">ssh</code>, <code class="language-plaintext highlighter-rouge">3478</code> ports:<div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>ufw <span class="nb">enable
sudo </span>ufw allow http
<span class="nb">sudo </span>ufw allow https
<span class="nb">sudo </span>ufw allow ssh
<span class="nb">sudo </span>ufw allow 3478
<span class="nb">sudo </span>ufw status
</pre></table></code></div></div><p>restart apache and coturn again by runnig:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl restart coturn
<span class="nb">sudo </span>systemctl restart apache2
</pre></table></code></div></div><li>Nevigate to you brwoser window, <code class="language-plaintext highlighter-rouge">NextCloud</code> -&gt; <code class="language-plaintext highlighter-rouge">User Icon</code> -&gt; <code class="language-plaintext highlighter-rouge">Administration settings</code> -&gt; <code class="language-plaintext highlighter-rouge">Talk</code>, add new TURN server <img data-proofer-ignore data-src="https://gitlab.com/Alimjoo/cdn_img/-/raw/main/nextcloud/tune_server.png" alt="TURN server" /> fill these parts and you will see success icon on right side like this: <img data-proofer-ignore data-src="https://gitlab.com/Alimjoo/cdn_img/-/raw/main/nextcloud/tune_server_success.png" alt="TURN server success" /> That is it, all set and done!</ol></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/tutorial/'>Tutorial</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/php/" class="post-tag no-text-decoration">php</a> <a href="/tags/ubuntu/" class="post-tag no-text-decoration">ubuntu</a> <a href="/tags/nextcloud/" class="post-tag no-text-decoration">nextcloud</a> <a href="/tags/coturn/" class="post-tag no-text-decoration">coturn</a> <a href="/tags/ssl/" class="post-tag no-text-decoration">ssl</a> <a href="/tags/certbot/" class="post-tag no-text-decoration">certbot</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h4>Recent Update</h4><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/setup-nextcloud/">Set Up NextCloud and Coturn on Ubuntu 22 Server</a><li><a href="/posts/MathJax-basic-tutorial/">MathJax basic tutorial and quick reference(MathJax教程)</a><li><a href="/posts/how-to-use-online-cal/">如何使用在线积分计算器</a><li><a href="/posts/ubuntu-nginx-php-ssl/">Ubuntu 20.04 Nginx(1.8) PHP(7.4) SSL(https) 修改php-fpm和nginx运行用户</a><li><a href="/posts/mahpiyatlik-1/">مەخپىيەتلىك —— قەدىمقى بابىلوننىڭ بايلىق باشقۇرۇش پاراسەتنامىسى</a></ul></div><div id="access-tags"><h4 class="text-muted">Trending Tags</h4><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%D8%A6%DB%87%D9%8A%D8%BA%DB%87%D8%B1%DA%86%DB%95/">ئۇيغۇرچە</a> <a class="post-tag" href="/tags/%D8%AA%DB%90%D8%B1%DB%95-%D9%82%DB%95%D8%BA%DB%95%D8%B2/">تېرە قەغەز</a> <a class="post-tag" href="/tags/macos/">macOS</a> <a class="post-tag" href="/tags/ubuntu/">ubuntu</a> <a class="post-tag" href="/tags/archlinux/">archlinux</a> <a class="post-tag" href="/tags/deepin/">deepin</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/ssl/">ssl</a> <a class="post-tag" href="/tags/wechat/">wechat</a></div></div></div><script src="/assets/jsdelivr/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h4 class="pl-3 pt-2 mb-2">Contents</h4><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ubuntu-nginx-php-ssl/"><div class="card-body"> <em class="timeago small" date="2022-04-04 12:10:00 +0800" >Apr 4, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip dir="auto">Ubuntu 20.04 Nginx(1.8) PHP(7.4) SSL(https) 修改php-fpm和nginx运行用户</h3><div class="text-muted small"><p dir="auto"> 准备工作 已在实例所属的安全组的入方向添加安全组规格并放行22、80、443端口。 关闭系统内部防火墙。 sudo ufw disable 安装 Nginx 运行以下命令，更新Ubuntu系统内的软件包。 sudo apt-get update 运行以下命令，安装Nginx。 sudo apt-get insta...</p></div></div></a></div><div class="card"> <a href="/posts/vps-ssh-locale_error-fix/"><div class="card-body"> <em class="timeago small" date="2024-11-17 11:10:00 +0800" >Nov 17, 2024</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip dir="auto">Fix Locale warning when ssh in to server</h3><div class="text-muted small"><p dir="auto"> When we ssh in to the VPS server or other linux system, some times our local machine language do not match target server language, and we get warning some thing like below, it is very common warnin...</p></div></div></a></div><div class="card"> <a href="/posts/ubuntu-deepin-wechat/"><div class="card-body"> <em class="timeago small" date="2024-12-29 11:10:00 +0800" >Dec 29, 2024</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip dir="auto">Ubuntu install wechat (Ubuntu 安装微信)</h3><div class="text-muted small"><p dir="auto"> deepin-wine deepin-wine环境与应用在Debian/Ubuntu上的移植仓库 使用deepin官方原版软件包 安装QQ/微信只需要两条命令 快速开始 添加仓库 首次使用时，你需要运行如下一条命令将移植仓库添加到系统中。 1 wget -O- https://deepin-wine.i-m.dev/setup.s...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/tera-kahaz-7/" class="btn btn-outline-primary" prompt="Older"><p>تېرە قەغەزنىڭ يەتتىنچىسى</p></a> <a href="/posts/vps-ssh-locale_error-fix/" class="btn btn-outline-primary" prompt="Newer"><p>Fix Locale warning when ssh in to server</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://piyazon.top">Piyazon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">All rights reserved.</span></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><h4 class="text-muted">Trending Tags</h4><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%D8%A6%DB%87%D9%8A%D8%BA%DB%87%D8%B1%DA%86%DB%95/">ئۇيغۇرچە</a> <a class="post-tag" href="/tags/%D8%AA%DB%90%D8%B1%DB%95-%D9%82%DB%95%D8%BA%DB%95%D8%B2/">تېرە قەغەز</a> <a class="post-tag" href="/tags/macos/">macOS</a> <a class="post-tag" href="/tags/ubuntu/">ubuntu</a> <a class="post-tag" href="/tags/archlinux/">archlinux</a> <a class="post-tag" href="/tags/deepin/">deepin</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/php/">php</a> <a class="post-tag" href="/tags/ssl/">ssl</a> <a class="post-tag" href="/tags/wechat/">wechat</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3" dir="auto"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script> function toHttps(wurl) { return (wurl.slice(0, 4) + "s" + wurl.slice(4)); } if ($(".weixin_video").length) { $.getJSON('https://api.allorigins.win/get?url=' + encodeURIComponent('https://mp.weixin.qq.com/mp/videoplayer?action=get_mp_video_play_url&vid=' + $("#player").attr("wxv")), function (data) { const respon = jQuery.parseJSON(data.contents); $("#player").attr("src", toHttps(respon['url_info'][0]['url'])); }); } </script> <script src="https://piyazon.top/assets/jsdelivr/simple-jekyll-search.min.js"></script> <script> var inputter = document.getElementById('search-inputtt'); document.getElementById('search-input').dispatchEvent(new Event('input', {bubbles:false})); const ENTER_KEY_CODE = 13; document.querySelector('#search-input').addEventListener('keyup', function(e) { if (e.keyCode === ENTER_KEY_CODE) { inputter.value = $(this).val(); inputter.dispatchEvent(new Event('input', {bubbles:true})); } }); SimpleJekyllSearch({ searchInput: document.getElementById('search-inputtt'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}" dir="auto">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p dir="auto">{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="/assets/jsdelivr/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="/assets/jsdelivr/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-MLWQK5VDEY"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-MLWQK5VDEY'); }); </script> <script> var h = document.getElementsByTagName("a"); for (let i = 0; i < h.length; i++) { h[i].setAttribute("dir", "auto"); } var pre = document.getElementsByClassName("post-preview"); for (let j = 0; j < pre.length; j++) { pre[j].setAttribute("dir", "auto"); } var table = document.getElementsByClassName("table-wrapper"); for (let i = 0; i < table.length; i++) { table[i].setAttribute("dir", "auto"); } var chlabel = $("track"); if (chlabel.attr("label") === "English&Chinese") { chlabel.attr("label", "English&汉语"); } </script> <script src="/assets/js/plyr/plyr.js"></script> <script> if ($("audio").length) { const player = new Plyr("#audio_player"); } </script> <script> window.onkeyup = vidCtrl; function vidCtrl(e) { const vid = document.querySelector('video'); const key = e.code; switch (key) { case "ArrowLeft": vid.currentTime = vid.currentTime - 15; if (vid.currentTime < 0) { vid.pause(); vid.currentTime = 0; } break; case "ArrowRight": vid.currentTime = vid.currentTime + 15; if (vid.currentTime > vid.duration) { vid.pause(); vid.currentTime = 0; } break; default: break; } } </script>
